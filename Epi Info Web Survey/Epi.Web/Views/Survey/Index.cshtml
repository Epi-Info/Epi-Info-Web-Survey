@model MvcDynamicForms.Form
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script type="text/javascript">
    $(document).ready(function () {
        // a workaround for a flaw in the demo system (http://dev.jqueryui.com/ticket/4375), ignore!
         
        $("#dialog").dialog({
            autoOpen: false,
            show: "blind",
            // hide: "explode",
            resizable: false,
            height: 300,
            modal: true
        });
        var responseUrl = GetRedirectionUrl();
        $('#url').val(responseUrl);
      
        if ($('#_showModalPopup').val() == 'True') {
            if ($('#_statusId').val() == '1') { //if clicking the save button for the first time
                $('#successContent').show();
                $('#successContent').append('<div class="success"><img src="../../Content/images/button_check.png" style="vertical-align:middle; padding-right: 10px;" alt=""/> Your survey has been saved.<button id="copy" type="button" name="copy" class="copylink">Get Survey Link</button></div>')
                //call your jquery modal popup method
                $("#dialog").dialog("open");

            }
            else {
                $('#successContent').show(); //in subsequest click we just show that the survey has been saved not the modal popup
                $('#successContent').append('<div class="success"><img src="../../Content/images/button_check.png" style="vertical-align:middle; padding-right: 10px;" alt=""/> Your survey has been saved.<button id="copy" type="button" name="copy" class="copylink">Get Survey Link</button></div>')
            }
            return true;
        }


    });

    $(document).ready(function () {

        $("#send").click(function () {


            var emailAddress = $("#email").val();
            var redirectUrl = GetRedirectionUrl();
            if (ValidateEmail(emailAddress)) {
                //Call notify function to send notification
                NotifyByEmail(emailAddress, redirectUrl);
                //close the modal popup after processing
                $("#dialog").dialog("close");
            }
            else {
                // $('#email').after('<span class="error">Enter a valid email address.</span>');
                alert('Enter a valid email address!');
            }
        });


         /*Open the modal popup on link click*/
        $('#copy').click(function () {
            $("#dialog").dialog("open");
            $('#url').val(GetRedirectionUrl());
            return false;
        });

    });

  
</script>

<div id="header">
            <h1>
                @Model.SurveyInfo.SurveyName 
                 
                </h1>
 </div>
 

    <div id="infobox">
        <div class="pages">



         @if (Model.NumberOfPages > 0)
          {
              int num = 0;
              
              

             for (int i = 1; Model.NumberOfPages > i - 1; i++)
              {
                  
                  num = i;  
                    if (i == 1 && Model.CurrentPage >1)
                        {   
                              <a  style="background-image: url('/Content/images/prev.png'); background-repeat:no-repeat; background-position:center; width:13px;"   href="@string.Format("{0}://{1}/survey/{2}/{3}", ViewContext.HttpContext.Request.Url.Scheme, ViewContext.HttpContext.Request.Url.Authority,  Model.ResponseId,Model.CurrentPage-1)"    class="nextprev" title="Previous Page">
                          &nbsp;&nbsp;&nbsp;
                              </a>
                       
            
                        }
                    



         if (Model.CurrentPage == i)
            {  
          <span class="current">@num</span>
          
            }
            else
            {  

       
         
                    <a href="@string.Format("{0}://{1}/survey/{2}/{3}", ViewContext.HttpContext.Request.Url.Scheme, ViewContext.HttpContext.Request.Url.Authority, Model.ResponseId, num) " title="Go to page"   >@num</a> 

                    
              }  

        }  

          if (Model.CurrentPage != Model.NumberOfPages )
            {  
                  
         <a    style="background-image: url('/Content/images/next.png');  background-repeat:no-repeat; background-position:center; width:13px;" href="@string.Format("{0}://{1}/survey/{2}/{3}", ViewContext.HttpContext.Request.Url.Scheme, ViewContext.HttpContext.Request.Url.Authority,  Model.ResponseId, Model.CurrentPage+1)" class="nextprev" title="Go to Next Page">
        &nbsp;&nbsp;&nbsp;
         </a>
          
            }
             
          } 


 
      
      </div>
	   
	  <div id="exit">
      <button class="exitsurvey" type="submit">Exit Survey</button>
      
      </div>
	  <div style="clear:both;"></div>
	 </div>

	<div id="content">
         <div id="successContent">
         
         </div>
     @if (!string.IsNullOrEmpty(Model.GetErrorSummary()))
        { 
        <div class="errormsg">
            
            <div class="image">
                <img src="../../Content/images/error.png" style="vertical-align: middle; padding-right: 10px;" alt=""/>
            </div>
            <div class="message">
              <span style="font-weight:bold; font-size:10pt;">Please correct the following errors before continuing:</span>
                <br/>
               
                 @Html.Raw(Model.GetErrorSummary())
            </div>
            <div style="clear: both;">
            </div>

        </div>
         } 
        @using (Html.BeginForm(null, null, FormMethod.Post, new { id = "myform" }))
        {  
           
              
             @Html.AntiForgeryToken()  
             @Html.Raw(Model.RenderHtml(true))
             
            @Html.HiddenFor(model => model.StatusId, new { id = "_statusId" })
             @Html.HiddenFor(model => model.IsSaved, new { id = "_showModalPopup" })
             @Html.HiddenFor(model => model.ResponseId, new { id = "_responseId" })
              
   	           
	        <div id="nav">
            <div id="prev" align="left">&nbsp;
             @if (Model.CurrentPage != 1)
             {  
		        
              <button class="prev" value="PreviousButton"  name="PreviousButton"  type="button" onclick="@string.Format("document.forms[0].action = '{0}://{1}/survey/{2}/{3}'; $('#myform').submit();", ViewContext.HttpContext.Request.Url.Scheme, ViewContext.HttpContext.Request.Url.Authority, Model.ResponseId, Model.CurrentPage - 1)"><img class="button" src="../../Content/images/arrow_left.png" alt=""/>&nbsp; Previous</button>
              
              
             }
             </div>
	 		 <div id="savediv" align="center"><button class="save" type="submit" id ="Savebutton" name="Savebutton" value="save"><img class="button" src="../../Content/images/save.png" alt=""/>&nbsp; Save</button>
             </div>
                 
              
               @if (Model.CurrentPage == Model.NumberOfPages)
               {  
               <div id="next" align="right"> 
              <button class="submits" type="submit"  name="Submitbutton" value="Submit" >
              Submit Survey &nbsp;<img class="button" src="../../Content/images/submit.png" alt=""/></button>
              </div>
               }
               else
               {
                    <div id="next" align="right">
                    <button class="next"  name="ContinueButton" type="button" onclick="@string.Format("document.forms[0].action = '{0}://{1}/survey/{2}/{3}'; $('#myform').submit();", ViewContext.HttpContext.Request.Url.Scheme, ViewContext.HttpContext.Request.Url.Authority, Model.ResponseId, Model.CurrentPage + 1)">Continue &nbsp;<img class="button" src="../../Content/images/arrow_right.png" alt=""/></button>
                    </div>
                      
               }




             
              </div>    
           
        }
       
     </div>

      <div class="demo">
              <div id="dialog" title="Your Survey has been saved.">
	            <p>Please copy and save the survey link to return to the survey at a later time.</p>
 	            <p>@*<input  id="url" type="text" style="width: 250px;"/>*@
                <textarea id="url" cols="70" rows="3" style="white-space:pre;"></textarea>
 	           @* <button id="copyClipboard" type="button" name="copy">Copy Link</button>*@</p>
 	            <hr/>
 	            <p>Optionally enter your email address to have the survey link emailed to you.</p>
 	            <p><label for="email">Email:</label> <input id="email" type="text" style="width: 250px;"/>
 	            <button id="send" type="button">Send</button></p>
                <br />
                <p style="font-size: 8pt; padding: 5px; background: #ffffa8;"><strong>Note:</strong> Your email address will not be saved and only be used to send you the survey link.</p>
               </div>
            </div> 